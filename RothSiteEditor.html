
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>rothamsted Site Editor</title>
  <link rel="icon" href="logo.png">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="jquery.orgchart.css">
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div id="top-button-container">
<button id="btn_expand">Expand all</button>
<button id="btn_collapse">Collapse all</button>
<button id="btn_show_content">Show Content</button>
<button id="btn_hide_content">Hide Content</button>
<label><input id="togglePan" type="checkbox" checked>Enable Pan</label>
<label><input id="toggleZoom" type="checkbox" unchecked>Enable Zoom</label>
</div>
	
<div id="editor-title">Rothamsted Site Editor</div>
	<p></p>
<div id="chart-container"></div>

<div id="detail-panel">

	<!-- this details panel does not yet display all node details -->
	<!-- and it doesn't have a way to update a node with the info somebody enters -->


	<label>Page Name</label>
	<p class="text-comments">The title of the selected node/webpage</p>
	<input type="text" id="page-name">

	<label>Original Page</label>
	<p class="text-comments">If a page has been renamed from an existing page, the original page reference/name is here</p>
	<input type="text" id="original-page">
	<label>URL</label>
	<input type="text" id="page-url">
	<a href="#" id="page-link" target="_blank">go there</a>
	<label>Notes</label>
	<p class="text-comments">Notes about new content.</p>
	<textarea type="text" id="page-notes"></textarea>
	
	
	<!-- This edit panel along the bottom of the screen seems to work fine -->
	
	<div id="edit-panel" class="view-state">

  <input type="text" id="key-word">
  <button type="button" id="btn-filter-node">Search</button>

  </div>

  <script type="text/javascript" src="jquery.min.js"></script>
  <script type="text/javascript" src="jquery.orgchart.js"></script>
		<script type="text/javascript" src="https://cdn.rawgit.com/stefanpenner/es6-promise/master/dist/es6-promise.auto.min.js"></script>
	<script type="text/javascript" src="html2canvas.min.js"></script>
  <script type="text/javascript">
   (function($){

  $(function() {
	  
	  
	  
		/* Need to amend this to 
		reference a json file on a local drive
    	*/
  $(function() {
   var datasource = {"id":"1568211244740234","name":"Homepage","className":"node shrink-box","children":[{"id":"1568211244742250","name":"Top Menu","className":"node shrink-box","children":[{"id":"1568211244743219","name":"News","className":"node shrink-box slide-up","children":[{"id":"1568211244744458","name":"GM Camelina Trial: Frequently asked questions","className":"node shrink-box slide-up"}]},{"id":"1568211244745504","name":"Events","className":"node shrink-box slide-up","children":[{"id":"1568211244746497","name":"Event 1","className":"node shrink-box slide-up"},{"id":"1568211244746575","name":"Event 2","className":"node shrink-box slide-up"},{"id":"1568211244747562","name":"Event 3","className":"node shrink-box slide-up"},{"id":"1568211244748424","name":"Event 4","className":"node shrink-box slide-up"}]},{"id":"1568211244749879","name":"About","className":"node shrink-box slide-up","children":[{"id":"1568211244750647","name":"Science Strategy","className":"node shrink-box slide-up"},{"id":"1568211244750371","name":"Our Values","className":"node shrink-box slide-up","children":[{"id":"1568211244751184","name":"Flexible Working","className":"node shrink-box slide-up"},{"id":"1568211244752127","name":"Athena SWAN","className":"node shrink-box slide-up"},{"id":"1568211244753070","name":"Diversity Policy","className":"node shrink-box slide-up"}]},{"id":"1568211244753404","name":"Diversity and Equality","className":"node shrink-box slide-up"},{"id":"1568211244754402","name":"Athena SWAN","className":"node shrink-box slide-up"},{"id":"1568211244754382","name":"National Capabilities","className":"node shrink-box slide-up"},{"id":"1568211244755352","name":"Collaboration and Innovation","className":"node shrink-box slide-up"},{"id":"1568211244756100","name":"Corporate Information and Funding","className":"node shrink-box slide-up","children":[{"id":"1568211244758729","name":"Board of Directors","className":"node shrink-box slide-up"},{"id":"1568211244759291","name":"Annual Reports","className":"node shrink-box slide-up"},{"id":"1568211244760372","name":"Reports","original":"","url":"https://www.rothamsted.ac.uk/rothamsted-reports","notes":"","className":"node shrink-box slide-up"}]},{"id":"1568211244760520","name":"History and Heritage","className":"node shrink-box slide-up","children":[{"id":"1568211244761526","name":"A visual History of Rothamsted.pdf","className":"node shrink-box slide-up"}]},{"id":"1568211244762368","name":"Environmental Management System","className":"node shrink-box slide-up"}]},{"id":"1568211244762364","name":"People","className":"node shrink-box slide-up"},{"id":"1568211244763311","name":"Careers","className":"node shrink-box slide-up","children":[{"id":"1568211244764032","name":"Data Privacy.doc","className":"node shrink-box slide-up"},{"id":"1568211244765934","name":"Current Vacancies","className":"node shrink-box slide-up"},{"id":"1568211244766542","name":"Studentships","className":"node shrink-box slide-up"},{"id":"1568211244766632","name":"International Fellowships","className":"node shrink-box slide-up"},{"id":"1568211244767980","name":"Work Experience","className":"node shrink-box slide-up"},{"id":"1568211244767413","name":"Work Placements and Internships","className":"node shrink-box slide-up"},{"id":"1568211244768368","name":"Apprenticeships","className":"node shrink-box slide-up","children":[{"id":"1568211244769680","name":"Apprentice life at Rothamsted","className":"node shrink-box slide-up","children":[{"id":"1568211244770484","name":"Matthew Berridge","className":"node shrink-box slide-up"},{"id":"1568211244771210","name":"Alice Belasai","className":"node shrink-box slide-up"},{"id":"1568211244771114","name":"David Steele","className":"node shrink-box slide-up"},{"id":"1568211244772972","name":"Hannah Walpole","className":"node shrink-box slide-up"}]}]},{"id":"1568211244773709","name":"Life at Rothamsted","className":"node shrink-box slide-up","children":[{"id":"1568211244775768","name":"Scientific Life for Students","original":"","url":"https://www.rothamsted.ac.uk/scientific-life-for-students","notes":"","className":"node science-colour shrink-box slide-up","children":[{"id":"1568211244776974","name":"Sophia Iqbal","className":"node science-colour shrink-box slide-up"},{"id":"1568211244776992","name":"George Lund","className":"node science-colour shrink-box slide-up"},{"id":"1568211244777406","name":"Cassie Sims","className":"node science-colour shrink-box slide-up"},{"id":"1568211244777721","name":"Susana Silvestre","className":"node science-colour shrink-box slide-up"},{"id":"1568211244778539","name":"Megan Rafter","className":"node science-colour shrink-box slide-up"}]}]},{"id":"1568211244778099","name":"Athena SWAN","className":"node shrink-box slide-up"},{"id":"1568211244779717","name":"Flexible Working","className":"node shrink-box slide-up"}]},{"id":"1568211244780386","name":"Contact","className":"node shrink-box slide-up"}]},{"id":"1568211244780014","name":"Main Menu","className":"node shrink-box","children":[{"id":"1568211244782253","name":"Our Science & Data","original":"Science","url":"https://www.rothamsted.ac.uk/our-science","notes":"","className":"node science-colour shrink-box","children":[{"id":"1568211244783542","name":"What we work on","original":"Our Science","url":"https://www.rothamsted.ac.uk/our-science","notes":"","className":"node science-colour shrink-box slide-up","children":[{"id":"1568211244784333","name":"Superior Crops","original":"","url":"https://www.rothamsted.ac.uk/superior-crops","notes":"","className":"node science-colour shrink-box slide-up"},{"id":"1568211244785228","name":"Securing Productivity","original":"","url":"https://www.rothamsted.ac.uk/securing-productivity","notes":"","className":"node science-colour shrink-box slide-up"},{"id":"1568211244785947","name":"Future Agri-Food Systems","original":"","url":"https://www.rothamsted.ac.uk/future-agri-food-systems","notes":"","className":"node science-colour shrink-box slide-up"}]},{"id":"1568211244786987","name":"Science Departments","original":"","url":"https://www.rothamsted.ac.uk/science-departments","notes":"","className":"node science-colour shrink-box slide-up","children":[{"id":"1568211244788884","name":"SAS","original":"","url":"https://www.rothamsted.ac.uk/sustainable-agriculture-sciences","notes":"","className":"node science-colour shrink-box slide-up"},{"id":"1568211244789960","name":"PS","original":"","url":"https://www.rothamsted.ac.uk/plant-sciences","notes":"","className":"node science-colour shrink-box slide-up"},{"id":"1568211244790422","name":"CAS","original":"","url":"https://www.rothamsted.ac.uk/computational-and-analytical-sciences","notes":"","className":"node science-colour shrink-box slide-up"},{"id":"1568211244790194","name":"BCP","original":"","url":"https://www.rothamsted.ac.uk/biointeractions-and-crop-protection","notes":"","className":"node science-colour shrink-box slide-up"}]},{"id":"1568211244791390","name":"Our Scientists","original":"","url":"https://www.rothamsted.ac.uk/staff-directory?type=Science#JOBTYPE-2","notes":"","className":"node science-colour shrink-box slide-up"},{"id":"1568211244792995","name":"Publications","original":"","url":"https://repository.rothamsted.ac.uk/","notes":"","className":"node science-colour shrink-box slide-up"},{"id":"1568211244792665","name":"Overview of our science","className":"node new-colour shrink-box slide-up"},{"id":"1568211244793499","name":"Research Projects","className":"node new-colour shrink-box slide-up"},{"id":"1568211244794112","name":"Resources for researchers","className":"node new-colour shrink-box slide-up","children":[{"id":"1568211244795712","name":"National Capabilities","original":"","url":"https://www.rothamsted.ac.uk/national-capabilities","notes":"","className":"node science-colour shrink-box slide-up","children":[{"id":"1568211244796218","name":"North Wyke Farm Platform","original":"","url":"https://www.rothamsted.ac.uk/farm-platform","notes":"","className":"node science-colour shrink-box slide-up","children":[{"id":"1568211244797233","name":"Hypothesis","className":"node science-colour shrink-box slide-up"},{"id":"1568211244798439","name":"Data Portal","className":"node science-colour shrink-box slide-up"}]},{"id":"1568211244798719","name":"Insect Survey","original":"","url":"https://www.rothamsted.ac.uk/insect-survey","notes":"","className":"node science-colour shrink-box slide-up"},{"id":"1568211244799710","name":"Long Term Experiments","original":"","url":"https://www.rothamsted.ac.uk/long-term-experiments","notes":"","className":"node science-colour shrink-box slide-up","children":[{"id":"1568211244800999","name":"Guide.pdf","className":"node science-colour shrink-box slide-up"},{"id":"1568211244800997","name":"Sample Archive","className":"node science-colour shrink-box slide-up"},{"id":"1568211244801617","name":"e-RA","className":"node science-colour shrink-box slide-up"}]}]},{"id":"1568211244801242","name":"Library, Collections and Archive","className":"node resources-colour shrink-box slide-up","children":[{"id":"1568211244803129","name":"LIS","className":"node resources-colour shrink-box slide-up","children":[{"id":"1568211244803736","name":"Library Catalogue","className":"node resources-colour shrink-box slide-up"},{"id":"1568211244804551","name":"Repository","className":"node resources-colour shrink-box slide-up"},{"id":"1568211244805409","name":"Archives Catalogue","className":"node resources-colour shrink-box slide-up"}]},{"id":"1568211244805402","name":"Willow Collection","className":"node resources-colour shrink-box slide-up"},{"id":"1568211244807456","name":"Sample Archive","className":"node resources-colour shrink-box slide-up","children":[{"id":"1568211244808184","name":"e-Ra","className":"node resources-colour shrink-box slide-up"}]}]},{"id":"1568211244808935","name":"Data Repositories, Models and Software","className":"node resources-colour shrink-box slide-up","children":[{"id":"1568211244809470","name":"Insect Bulletin","className":"node resources-colour shrink-box slide-up"},{"id":"1568211244810083","name":"Phi-Base","className":"node resources-colour shrink-box slide-up"},{"id":"1568211244810914","name":"Farm Platform Data Portal","className":"node resources-colour shrink-box slide-up"},{"id":"1568211244811860","name":"E-Ra","className":"node resources-colour shrink-box slide-up"},{"id":"1568211244811404","name":"ECN","className":"node resources-colour shrink-box slide-up","children":[{"id":"1568211244813268","name":"ECN Booklet.pdf","className":"node resources-colour shrink-box slide-up"}]},{"id":"1568211244814963","name":"Models and Analytical Tools","className":"node resources-colour shrink-box slide-up","children":[{"id":"1568211244815825","name":"Roth-C","className":"node resources-colour shrink-box slide-up"},{"id":"1568211244816775","name":"RothLime","className":"node resources-colour shrink-box slide-up"},{"id":"1568211244817462","name":"Motor","className":"node resources-colour shrink-box slide-up"}]},{"id":"1568211244817163","name":"Sirius Wheat Sim","className":"node resources-colour shrink-box slide-up"},{"id":"1568211244818404","name":"LARS-WG Weather Sim","className":"node resources-colour shrink-box slide-up"}]},{"id":"1568211244819152","name":"Interactive Web based Tools","className":"node resources-colour shrink-box slide-up","children":[{"id":"1568211244819676","name":"FarmCrapApp","className":"node resources-colour shrink-box slide-up"},{"id":"1568211244820486","name":"CropProtect","className":"node resources-colour shrink-box slide-up"},{"id":"1568211244820308","name":"KnetMiner","className":"node resources-colour shrink-box slide-up"}]}]}]},{"id":"1568211244821312","name":"Learn","original":"Impact","url":"https://www.rothamsted.ac.uk/our-impact","notes":"Create a home for impact stories with a different title: “Stories from our Science”  \n\nSchool page we definitely need – Leanne to draft\nAgree would be good to showcase the new videos somehow.\n ","className":"node impact-colour shrink-box","children":[{"id":"1568211244822021","name":"Blogs","original":"","url":"https://www.rothamsted.ac.uk/articles","notes":"","className":"node impact-colour shrink-box slide-up"},{"id":"1568211244822240","name":"Public Engagement","original":"","url":"https://www.rothamsted.ac.uk/public-engagement","notes":"","className":"node engage-colour shrink-box slide-up"},{"id":"1568211244823861","name":"Stories from our Science","className":"node new-colour shrink-box slide-up","children":[{"id":"1568211244823880","name":"Impact Stories","original":"","url":"https://www.rothamsted.ac.uk/impact-stories","notes":"","className":"node impact-colour shrink-box slide-up"},{"id":"1568211244824761","name":"Success Stories","original":"","url":"https://www.rothamsted.ac.uk/success-stories","notes":"","className":"node impact-colour shrink-box slide-up"},{"id":"1568211244825858","name":"Our Impact Overview","original":"","url":"https://www.rothamsted.ac.uk/our-impact","notes":"","className":"node impact-colour shrink-box slide-up"}]}]},{"id":"1568211244826256","name":"Work with us","original":"Engage with us","url":"https://www.rothamsted.ac.uk/engaging-with-us","notes":"","className":"node engage-colour shrink-box","children":[{"id":"1568211244827521","name":"Opportunities...","original":"Opportunities to Engage","url":"https://www.rothamsted.ac.uk/opportunities-to-engage","notes":"","className":"node shrink-box engage-colour","children":[{"id":"1568211244827622","name":"For Businesses","original":"Business Engagement","url":"https://www.rothamsted.ac.uk/business-engagement","notes":"","className":"node engage-colour shrink-box","children":[{"id":"1568211244828786","name":"Engagement Opportunities","className":"node engage-colour shrink-box"},{"id":"1568211244829270","name":"Impact Stories","className":"node engage-colour shrink-box"}]},{"id":"1568211244829400","name":"For Policy Makers","original":"Engaging With Policy Makers","url":"https://www.rothamsted.ac.uk/policy-makers","notes":"","className":"node engage-colour shrink-box"},{"id":"1568211244831970","name":"For Farmers","original":"Knowledge Exchange","url":"https://www.rothamsted.ac.uk/knowledge-exchange","notes":"NOTE: Wil and mel\n","className":"node engage-colour shrink-box","children":[{"id":"1568211244832029","name":"Open Days (events)","className":"node engage-colour shrink-box"},{"id":"1568211244832922","name":"Farming Innovatively? (CTA Mailto:)","className":"node engage-colour shrink-box"},{"id":"1568211244833734","name":"Impact Stories","className":"node engage-colour shrink-box"}]},{"id":"1568211244833964","name":"For international development","original":"Global Partnerships","url":"https://www.rothamsted.ac.uk/global","notes":"NOTE: Share suggested content with nicki\n","className":"node engage-colour shrink-box","children":[{"id":"1568211244834610","name":"China","className":"node engage-colour shrink-box","children":[{"id":"1568211244835155","name":"AgriTech in China","className":"node engage-colour shrink-box"},{"id":"1568211244836303","name":"CSIA","className":"node engage-colour shrink-box"},{"id":"1568211244836381","name":"CINAG","className":"node engage-colour shrink-box"}]},{"id":"1568211244837047","name":"India","className":"node engage-colour shrink-box"},{"id":"1568211244837120","name":"Brazil","className":"node engage-colour shrink-box"},{"id":"1568211244838270","name":"Africa","className":"node engage-colour shrink-box"},{"id":"1568211244838957","name":"Fellowship Scheme","className":"node engage-colour shrink-box"},{"id":"1568211244839050","name":"Rothamsted International","original":"","url":"https://www.rothamsted.ac.uk/ri","notes":"","className":"node engage-colour shrink-box","children":[{"id":"1568211244840741","name":"About","className":"node engage-colour shrink-box","children":[{"id":"1568211244840971","name":"Case Studies","className":"node engage-colour shrink-box"}]},{"id":"1568211244841052","name":"Current Opportunities","className":"node engage-colour shrink-box","children":[{"id":"1568211244843000","name":"25th Anniversary Fellowships","className":"node engage-colour shrink-box"},{"id":"1568211244842225","name":"Food Beacon Fellowships","className":"node engage-colour shrink-box"}]},{"id":"1568211244843273","name":"Support Us","className":"node engage-colour shrink-box"}]}]},{"id":"1568211244843387","name":"For Entrepreneurs","className":"node new-colour shrink-box"},{"id":"1568211244844702","name":"For Investors","original":"","url":"","notes":"NOTE: Angela ","className":"node new-colour shrink-box"},{"id":"1568211244844223","name":"For Researchers","original":"","url":"","notes":"NOTE: Damon in grants","className":"node new-colour shrink-box"}]},{"id":"1568211244846531","name":"Engagement","original":"Engage with us","url":"https://www.rothamsted.ac.uk/engaging-with-us","notes":"","className":"node engage-colour shrink-box","children":[{"id":"1568211244848809","name":"Collaborative R&D","className":"node new-colour shrink-box"},{"id":"1568211244848159","name":"Scientific Services","className":"node new-colour shrink-box"},{"id":"1568211244849602","name":"Consultancy","className":"node new-colour shrink-box"},{"id":"1568211244849311","name":"Studentships","className":"node new-colour shrink-box"},{"id":"1568211244850868","name":"Technology Licensing","className":"node new-colour shrink-box"},{"id":"1568211244850522","name":"Centres for Agricultural Innovation","className":"node engage-colour shrink-box","children":[{"id":"1568211244851703","name":"AgriMetrics","className":"node engage-colour shrink-box"},{"id":"1568211244852655","name":"CHAP","original":"","url":"","notes":"Note: Check with Achim to remove...","className":"node engage-colour shrink-box"},{"id":"1568211244852853","name":"CIEL","className":"node engage-colour shrink-box"}]},{"id":"1568211244853176","name":"Funding for innovation","original":"","url":"","notes":"NOTE: explain models  and programmes here, including farminn","className":"node new-colour shrink-box","children":[{"id":"1568211244854029","name":"Impact Lab","className":"node engage-colour shrink-box"},{"id":"1568211244854386","name":"Cornwall Agritech","className":"node engage-colour shrink-box"},{"id":"1568211244855906","name":"AgRIA","className":"node engage-colour shrink-box","children":[{"id":"1568211244855814","name":"AgRIA Short Leaps","original":"","url":"","notes":"NOTE: remove and move to AgRIA","className":"node engage-colour shrink-box"}]},{"id":"1568211244856317","name":"FarmInn","className":"node engage-colour shrink-box"}]}]}]},{"id":"1568211244856362","name":"Services","original":"Resources","url":"https://www.rothamsted.ac.uk/facilities-and-resources","notes":"","className":"node resources-colour shrink-box","children":[{"id":"1568211244857208","name":"Specialist Science Facilities","className":"node resources-colour shrink-box slide-up","children":[{"id":"1568211244858726","name":"Denis Lab","className":"node resources-colour shrink-box slide-up"},{"id":"1568211244859261","name":"Harmonic Verticle Radar","className":"node resources-colour shrink-box slide-up"},{"id":"1568211244859399","name":"Our Farms","className":"node resources-colour shrink-box slide-up","children":[{"id":"1568211244860582","name":"See our Farm Equipment","className":"node resources-colour shrink-box slide-up"}]},{"id":"1568211244860451","name":"Livestock and Farm Resources, North Wyke","className":"node resources-colour shrink-box slide-up"},{"id":"1568211244861682","name":"Insectary","className":"node resources-colour shrink-box slide-up"},{"id":"1568211244861645","name":"AFSIS Lab","className":"node resources-colour shrink-box slide-up"},{"id":"1568211244862427","name":"Field Scanalyser","original":"","url":"","notes":"NOTE: Ask Malcolm","className":"node resources-colour shrink-box slide-up","children":[{"id":"1568211244863840","name":"Camera and Sensors","className":"node resources-colour shrink-box slide-up"},{"id":"1568211244864596","name":"Publications","className":"node resources-colour shrink-box slide-up"},{"id":"1568211244864195","name":"Videos","className":"node resources-colour shrink-box slide-up"}]},{"id":"1568211244865101","name":"Cereal Transformations","original":"","url":"","notes":"","className":"node resources-colour shrink-box slide-up","children":[{"id":"1568211244866071","name":"Transformation Options.docx","className":"node resources-colour shrink-box slide-up"},{"id":"1568211244866548","name":"Requirements for Transformations","className":"node resources-colour shrink-box slide-up"},{"id":"1568211244866693","name":"Booking Form.xlsx","className":"node resources-colour shrink-box slide-up"},{"id":"1568211244867412","name":"Publications","className":"node resources-colour shrink-box slide-up"}]},{"id":"1568211244867890","name":"Glasshouses and Controlled Environments","className":"node resources-colour shrink-box slide-up","children":[{"id":"1568211244868243","name":"Current Facilities.pdf","className":"node resources-colour shrink-box slide-up"}]}]},{"id":"1568211244869139","name":"Cross Cutting Capabilities","className":"node resources-colour shrink-box slide-up","children":[{"id":"1568211244870271","name":"Bioimaging","className":"node resources-colour shrink-box slide-up","children":[{"id":"1568211244870854","name":"Booking Form","className":"node resources-colour shrink-box slide-up"},{"id":"1568211244871337","name":"Equipment","className":"node resources-colour shrink-box slide-up"},{"id":"1568211244871377","name":"Downloads","className":"node resources-colour shrink-box slide-up"},{"id":"1568211244872291","name":"Publications","className":"node resources-colour shrink-box slide-up"}]},{"id":"1568211244872587","name":"Metabolomics","className":"node resources-colour shrink-box slide-up","children":[{"id":"1568211244873277","name":"Equipment","className":"node resources-colour shrink-box slide-up"},{"id":"1568211244873815","name":"Publications","className":"node resources-colour shrink-box slide-up"}]},{"id":"1568211244874202","name":"Analytical Chemistry","className":"node resources-colour shrink-box slide-up","children":[{"id":"1568211244875246","name":"Equipment","className":"node resources-colour shrink-box slide-up"},{"id":"1568211244875193","name":"Services Offered","className":"node resources-colour shrink-box slide-up"},{"id":"1568211244876614","name":"Harpenden Lab Brochure.pdf","className":"node resources-colour shrink-box slide-up"}]}]}]}]},{"id":"1568211244876939","name":"Body","className":"node shrink-box","children":[{"id":"1568211244878716","name":"6 tiles","original":"","url":"","notes":"","className":"node new-colour shrink-box","children":[{"id":"1568211244879327","name":"Do Business & Find Funding","className":"node new-colour shrink-box slide-up"},{"id":"1568211244879817","name":"About Feeding the World","className":"node new-colour shrink-box slide-up"},{"id":"1568211244879432","name":"Engaging with schools and the public","className":"node new-colour shrink-box slide-up"},{"id":"1568211244880290","name":"Our progress and latest new","className":"node new-colour shrink-box slide-up"},{"id":"1568211244880322","name":"Open Access Research","className":"node new-colour shrink-box slide-up"},{"id":"1568211244881022","name":"Scientific Services","className":"node new-colour shrink-box slide-up"}]},{"id":"1568211244882599","name":"Our Purpose","original":"","url":"","notes":"Task: Write a better purpose statement that actually inspires and informs.","className":"node shrink-box"},{"id":"1568211244882886","name":"Our Science","className":"node shrink-box"},{"id":"1568211244883659","name":"Our Impacts","className":"node shrink-box"},{"id":"1568211244883293","name":"Engaging With Us","className":"node shrink-box"},{"id":"1568211244884159","name":"Our Values","className":"node shrink-box"},{"id":"1568211244884833","name":"Global Partnerships","className":"node shrink-box"},{"id":"1568211244885557","name":"Our Locations","className":"node shrink-box"}]},{"id":"1568211244885741","name":"Footer","className":"node shrink-box","children":[{"id":"1568211244886534","name":"Disclaimer","className":"node shrink-box"},{"id":"1568211244886503","name":"Privacy and Cookies","className":"node shrink-box"},{"id":"1568211244887994","name":"Staff Information","className":"node shrink-box"},{"id":"1568211244887187","name":"SiteMap","className":"node shrink-box"}]}]}

	
	  
  var oc = $('#chart-container').orgchart();

	  
    var getId = function() {
      return (new Date().getTime()) * 1000 + Math.floor(Math.random() * 1001);
    };
		  

	function refresh_chart() {
    oc.init({
      'data' : datasource,
      'chartClass': 'edit-state',
      'exportButton': true,
		'exportfilename': 'RothWebChart',
		'direction': 'l2r',
		'pan': true,
		'draggable': true,
      'parentNodeSymbol': 'fa-th-large',
      'createNode': function($node, data) {
        $node[0].id = getId();
        $node[0].name = data.name;
        $node[0].original = data.original;
        $node[0].url = data.url;
        $node[0].notes = data.notes;
      }
    });
  }	 
	  
	  refresh_chart();
	  
	  $('#btn_expand').on('click', function() {
	  var $temp = oc.$chart.find('.hidden').removeClass('hidden');
      $temp[0].offsetWidth;
      $temp.find('.slide-up').removeClass('slide-up');
    });
    
    $('#btn_collapse').on('click', function() {
      oc.hideChildren(oc.$chart.find('.node:first'));
    });
	  
	  
	  		
			  $('#btn_show_content').on('click', function() {
	
				 oc.$chart.find('.content').removeClass('condensed');
				 oc.$chart.find('.node').removeClass('shrink-box ');
			  });			  
	  
	  		$('#btn_hide_content').on('click', function() {

				 oc.$chart.find('.content').addClass('condensed');
				 oc.$chart.find('.node').addClass('shrink-box ');
			  });
		
	  
	   
    $('#togglePan').on('click', function() {
      // of course, oc.setOptions({ 'pan': this.checked }); is also OK.
      oc.setOptions('pan', this.checked);
    });
    
    $('#toggleZoom').on('click', function() {
      // of course, oc.setOptions({ 'zoom': this.checked }); is also OK.
      oc.setOptions('zoom', this.checked);
    });
		
	 $("#btn-export-hier").on("click", function() {
		 
		 
      if (!$("pre").length) {
        var hierarchy = oc.getHierarchy();
        $("#btn-export-hier")
         // .after("<pre>")
          //.next()
          ////.append(JSON.stringify(hierarchy, null, 2));
      	}
		 

		var obj = hierarchy;
		saveText( JSON.stringify(obj), "filename.json" );
		
		});
	  
	  function saveText(text, filename){
  var a = document.createElement('a');
  a.setAttribute('href', 'data:text/plain;charset=utf-u,'+encodeURIComponent(text));
  a.setAttribute('download', filename);
  a.click()
}
	  
	 var selectedNode;

    oc.$chartContainer.on('click', '.node', function() {
      selectedNode = $(this);
	//update all the text fields in the 
	//right panel with the selected node details
      $('#selected-node').val(selectedNode.find('.title').text()).data('node', selectedNode);
      $('#page-name').val(selectedNode.find('.title').text()).data('node', selectedNode);
      $('#original-page').val(selectedNode.find('.content').text()).data('node', selectedNode);
      $('#page-url').val(selectedNode.find('.url').text()).data('node', selectedNode);
      $('#page-notes').val(selectedNode.find('.notes').text()).data('node', selectedNode);
      //and uypdate the link
	  $('#page-link').attr("href", $('#page-url').val());
		
			  $('#detail-panel input[type=\'text\'], #detail-panel textarea[type=\'text\']').on('change keyup paste mouseup', function() {
    			// var input_selected_name = $('#page-name');
				var oc_node = oc.$chart.find(`div#${$('div.node.focused')[0].id}`);
				oc_node[0].name = $('#page-name')[0].value;
				oc_node[0].original = $('#original-page')[0].value;
				oc_node[0].url = $('#page-url')[0].value;
				oc_node[0].notes = $('#page-notes')[0].value;
				$('#page-link').attr("href", $('#page-url').val());

				$('#selected-node').val($("#page-name").val());
				selectedNode.find('.title').text( oc_node[0].name );  
				selectedNode.find('.content').text(  oc_node[0].original );
				selectedNode.find('.url').text(  oc_node[0].url );
				selectedNode.find('.notes').text(  oc_node[0].notes );

			  });
		
		
		
			  $('#btn-colour-one').on('click', function() {
				 var ob_node = oc.$chart.find(`div#${$('div.node.focused')[0].id}`);
				  selectedNode.removeClass('science-colour impact-colour engage-colour resources-colour new-colour');
				  selectedNode.addClass('science-colour');
			  });
		
				$('#btn-colour-two').on('click', function() {
				 var ob_node = oc.$chart.find(`div#${$('div.node.focused')[0].id}`);
				  selectedNode.removeClass('science-colour impact-colour engage-colour resources-colour new-colour');
				  selectedNode.addClass('impact-colour');
			  });				
		
				$('#btn-colour-three').on('click', function() {
				 var ob_node = oc.$chart.find(`div#${$('div.node.focused')[0].id}`);
				  selectedNode.removeClass('science-colour impact-colour engage-colour resources-colour new-colour');
				  selectedNode.addClass('engage-colour');
			  });			
		
				$('#btn-colour-four').on('click', function() {
				 var ob_node = oc.$chart.find(`div#${$('div.node.focused')[0].id}`);
				  selectedNode.removeClass('science-colour impact-colour engage-colour resources-colour new-colour');
				  selectedNode.addClass('resources-colour');
			  });				
		
				$('#btn-colour-five').on('click', function() {
				 var ob_node = oc.$chart.find(`div#${$('div.node.focused')[0].id}`);
				  selectedNode.removeClass('science-colour impact-colour engage-colour resources-colour new-colour');
				  selectedNode.addClass('new-colour');
			  });				
		
				$('#btn-colour-six').on('click', function() {
				 var ob_node = oc.$chart.find(`div#${$('div.node.focused')[0].id}`);
				  selectedNode.removeClass('science-colour impact-colour engage-colour resources-colour new-colour');
			  });
		
	});
	  
	  
	  	/* This custom function
		is supposed to update the node info in the json
		It works, but has issues:
			Only node attributes edited in the panel are exported to JSON, i.e existing details are not exported
			
			
    	*/
		

	  


    oc.$chartContainer.on('click', '.orgchart', function(event) {
      if (!$(event.target).closest('.node').length) {
        $('#selected-node').val('');
      }
    });

    $('input[name="chart-state"]').on('click', function() {
      $('.orgchart').toggleClass('edit-state', this.value !== 'view');
      $('#edit-panel').toggleClass('edit-state', this.value === 'view');
      if ($(this).val() === 'edit') {
        $('.orgchart').find('tr').removeClass('hidden')
          .find('td').removeClass('hidden')
          .find('.node').removeClass('slide-up slide-down slide-right slide-left');
      } else {
        $('#btn-reset').trigger('click');
      }
    });

    $('input[name="node-type"]').on('click', function() {
      var $this = $(this);
      if ($this.val() === 'parent') {
        $('#edit-panel').addClass('edit-parent-node');
        $('#new-nodelist').children(':gt(0)').remove();
      } else {
        $('#edit-panel').removeClass('edit-parent-node');
      }
    });

    $('#btn-add-input').on('click', function() {
      $('#new-nodelist').append('<li><input type="text" class="new-node"></li>');
    });

    $('#btn-remove-input').on('click', function() {
      var inputs = $('#new-nodelist').children('li');
      if (inputs.length > 1) {
        inputs.last().remove();
      }
    });
	  
	  
	

    $('#btn-add-nodes').on('click', function() {
      var $chartContainer = $('#chart-container');
      var nodeVals = [];
      $('#new-nodelist').find('.new-node').each(function(index, item) {
        var validVal = item.value.trim();
        if (validVal.length) {
          nodeVals.push(validVal);
        }
      });
      var $node = $('#selected-node').data('node');
      if (!nodeVals.length) {
        alert('Please input value for new node');
        return;
      }
      var nodeType = $('input[name="node-type"]:checked');
      if (!nodeType.length) {
        alert('Please select a node type');
        return;
      }
      if (nodeType.val() !== 'parent' && !$('.orgchart').length) {
        alert('Please creat the root node firstly when you want to build up the orgchart from the scratch');
        return;
      }
      if (nodeType.val() !== 'parent' && !$node) {
        alert('Please select one node in orgchart');
        return;
      }
      if (nodeType.val() === 'parent') {
        if (!$chartContainer.children('.orgchart').length) {// if the original chart has been deleted
          oc = $chartContainer.orgchart({
            'data' : { 'name': nodeVals[0] },
            'exportButton': true,
            'exportFilename': 'RothWeb',
            'parentNodeSymbol': 'fa-th-large',
            'createNode': function($node, data) {
              $node[0].id = getId();
            }
          });
          oc.$chart.addClass('view-state');
        } else {
          oc.addParent($chartContainer.find('.node:first'), { 'name': nodeVals[0], 'id': getId() });
        }
      } else if (nodeType.val() === 'siblings') {
        if ($node[0].id === oc.$chart.find('.node:first')[0].id) {
          alert('You are not allowed to directly add sibling nodes to root node');
          return;
        }
        oc.addSiblings($node, nodeVals.map(function (item) {
            return { 'name': item, 'relationship': '110', 'id': getId() };
          }));
      } else {
        var hasChild = $node.parent().attr('colspan') > 0 ? true : false;
        if (!hasChild) {
          var rel = nodeVals.length > 1 ? '110' : '100';
          oc.addChildren($node, nodeVals.map(function (item) {
              return { 'name': item, 'relationship': rel, 'id': getId() };
            }));
        } else {
          oc.addSiblings($node.closest('tr').siblings('.nodes').find('.node:first'), nodeVals.map(function (item) {
              return { 'name': item, 'relationship': '110', 'id': getId() };
            }));
        }
      }
    });

    $('#btn-delete-nodes').on('click', function() {
      var $node = $('#selected-node').data('node');
      if (!$node) {
        alert('Please select one node in orgchart');
        return;
      } else if ($node[0] === $('.orgchart').find('.node:first')[0]) {
        if (!window.confirm('Are you sure you want to delete the whole chart?')) {
          return;
        }
      }
      oc.removeNodes($node);
      $('#selected-node').val('').data('node', null);
    });

    $('#btn-reset').on('click', function() {
      $('.orgchart').find('.focused').removeClass('focused');
      $('#selected-node').val('');
      $('#new-nodelist').find('input:first').val('').parent().siblings().remove();
      $('#node-type-panel').find('input').prop('checked', false);
    });

  });
	   
	   
	   function filterNodes(keyWord) {
  if (!keyWord.length) {
    window.alert("Please type key word firstly.");
    return;
  } else {
    var $chart = $(".orgchart");
    // disalbe the expand/collapse feture
    $chart.addClass("noncollapsable");
    // distinguish the matched nodes and the unmatched nodes according to the given key word
    $chart
      .find(".node")
      .filter(function(index, node) {
        return (
          $(node)
            .text()
            .toLowerCase()
            .indexOf(keyWord) > -1
        );
      })
      .addClass("matched")
      .closest("table")
      .parents("table")
      .find("tr:first")
      .find(".node")
      .addClass("retained");
    // hide the unmatched nodes
    $chart.find(".matched,.retained").each(function(index, node) {
      $(node)
        .removeClass("slide-up")
        .closest(".nodes")
        .removeClass("hidden")
        .siblings(".lines")
        .removeClass("hidden");
      var $unmatched = $(node)
        .closest("table")
        .parent()
        .siblings()
        .find(".node:first:not(.matched,.retained)")
        .closest("table")
        .parent()
        .addClass("hidden");
      $unmatched
        .parent()
        .prev()
        .children()
        .slice(1, $unmatched.length * 2 + 1)
        .addClass("hidden");
    });
    // hide the redundant descendant nodes of the matched nodes
    $chart.find(".matched").each(function(index, node) {
      if (
        !$(node)
          .closest("tr")
          .siblings(":last")
          .find(".matched").length
      ) {
        $(node)
          .closest("tr")
          .siblings()
          .addClass("hidden");
      }
    });
  }
}

function clearFilterResult() {
  $(".orgchart")
    .removeClass("noncollapsable")
    .find(".node")
    .removeClass("matched retained")
    .end()
    .find(".hidden")
    .removeClass("hidden")
    .end()
    .find(".slide-up, .slide-left, .slide-right")
    .removeClass("slide-up slide-right slide-left");
}

	    $("#btn-filter-node").on("click", function() {
			      clearFilterResult();
      filterNodes($("#key-word").val());
    });
	   

	   $("#key-word").on("keyup", function(event) {
      if (event.which === 13) {
        filterNodes(this.value);
      } else if (event.which === 8 && this.value.length === 0) {
        clearFilterResult();
      }
    });
	    }); 
	   
	   
})(jQuery);
	  


  </script>
  </body>
</html>
